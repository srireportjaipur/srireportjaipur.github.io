<!DOCTYPE html>
<html class="js no-touch" style>

<head>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="/js/fetchImage.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>

    <style>
        * {
            padding: 0pt;
            margin: 0pt
        }

        h3.type.serch-result {
            margin-bottom: 20px;
            margin-top: 20px
        }

        .overflow-div {
            text-align: left;
            /* overflow-x: none; */
            /* padding-right: 50px; */
            /* height: 450px */
        }

        .card-front {
            padding: 5px;
            width: 100%;
            /* Occupy full width of the container */
            max-width: 800px;
            /* Limit the maximum width for a card-like appearance */
            margin: 0 auto;
            /* Center the card horizontally */
            /* aspect-ratio: 1.5; */
            /* Maintain ID card aspect ratio */
            box-sizing: border-box;
            /* Include padding in the width */
            background-color: #fff;
            /* Optional: add a background color for visibility */
            border: 1px solid #ccc;
            /* Optional: add a border */
            border-radius: 10px;
            /* Optional: rounded corners */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            /* Optional: add a shadow */
            overflow: hidden;
            /* Ensure content doesn't overflow */
        }


        .container-inner {
            width: 100%;
            /* Make contai
            /* Ensure padding is included in width */
        }


        .g-table th.report-type {
            font-family: Tahoma, Verdana, sans-serif;
            font-weight: bold;
            width: 100%;
            font-size: 13.5pt;
            background-color: green;
            color: white;
            text-align: center
        }

        .table-header {
            width: 100%;
            border-collapse: collapse
        }

        .table-header th,
        .table-header td {
            color: green;
            margin: 0pt;
            padding: 0pt;
            text-align: center;
            font-weight: bold
        }

        img.logo-r {
            width: 57pt
        }

        img.microscope {
            width: 47pt
        }

        img.product {
            width: 95pt
        }

        img.product:hover {
            cursor: -webkit-zoom-in;
            cursor: -moz-zoom-in;
            -ms-transform: scale(1.5);
            -webkit-transform: scale(1.5);
            transform: scale(1.5)
        }

        th.c-name {
            white-space: nowrap;
            font-size: 24px
        }

        th.c-name-hindi {
            white-space: nowrap;
            font-size: 24px
        }

        td.c-add {
            white-space: nowrap;
            font-size: 14px
        }

        .g-table {
            width: 100%;
            line-height: normal;
            border-collapse: collapse
        }

        .g-table th {
            font-family: serif !important;
            white-space: nowrap;
            font-size: 12pt;
            text-align: justify
        }

        .g-table td {
            font-family: serif !important;
            white-space: nowrap;
            font-size: 12pt;
            text-align: justify
        }

        td.r-no,
        th.imp {
            color: darkred;
            font-weight: bold
        }

        span.mm {
            font-weight: bold
        }

        img.qr-code {
            width: 90pt
        }

        img.jksign {
            width: 110pt
        }

        .fg-footer {
            font-family: serif !important;
            white-space: nowrap;
            font-weight: bold;
            border: 1.75px solid green;
            box-shadow: 0px 4px 0px 0px green;
            border-radius: 12pt;
            background-clip: padding-box;
            font-size: 13.5pt;
            background-color: #f3f7d6;
            color: green
        }

        span.sign-text {
            text-align: center;
            color: green;
            font-size: 9pt
        }

        span.sign-text2 {
            text-align: center;
            color: green;
            font-size: 9pt
        }

        @media only screen and (max-width:500px) {
            .overflow-div {
                overflow-x: none;
            }

            .card-front {
                margin-right: 0px;
                margin-left: 0px
            }

            .container-inner {
                width: 242pt
            }

            th.c-name {
                font-size: 14px
            }

            th.c-name-hindi {
                font-size: 14px
            }

            td.c-add {
                font-size: 8px
            }

            img.logo-r {
                width: 38px
            }

            img.microscope {
                width: 30px
            }

            .g-table th.report-type {
                font-size: 8.5pt
            }

            img.product {
                width: 57pt
            }

            img.qr-code {
                width: 60pt
            }

            img.jksign {
                width: 60pt
            }

            .g-table th {
                font-size: 7pt
            }

            .g-table td {
                font-size: 7pt
            }

            span.sign-text {
                text-align: center;
                color: green;
                font-size: 6pt
            }

            span.sign-text2 {
                text-align: center;
                color: green;
                font-size: 7pt
            }

            .fg-footer {
                font-size: 7.5pt
            }
        }
    </style>
</head>

<body
    style="font-family: Arial, sans-serif; background-color: white; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh;">

    <!-- Navigation Bar -->
    <div
        style="width: 100%; background-color: #4A90E2; padding: 20px 40px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); text-align: center;">
        <h1 style="color: #ffffff; font-size: 24px; margin: 0;">Print Card</h1>
    </div>

    <!-- Form Card -->
    <div
        style="background-color: #ffffff; width: 100%; max-width: 400px; margin: 40px 20px; padding: 30px; border-radius: 8px; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);">
        <form id="gemForm" style="display: flex; flex-direction: column;">
            <label for="reportNumber" style="margin-bottom: 8px; font-weight: 600; color: #333333;">Report
                Number:</label>
            <input type="text" id="reportNumber" name="reportNumber" value="SRI/AA/" required
                style="padding: 10px 15px; margin-bottom: 20px; border: 1px solid #cccccc; border-radius: 4px; font-size: 16px;">

            <label for="weight" style="margin-bottom: 8px; font-weight: 600; color: #333333;">Weight:</label>
            <input type="number" step="0.01" id="weight" name="weight" required
                style="padding: 10px 15px; margin-bottom: 20px; border: 1px solid #cccccc; border-radius: 4px; font-size: 16px;">

            <button type="submit"
                style="padding: 12px; background-color: #4A90E2; color: #ffffff; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; transition: background-color 0.3s;">
                Submit
            </button>
        </form>
    </div>

    <script>
        document.getElementById('gemForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevents the form from reloading the page
            const reportNo = document.getElementById('reportNumber').value;
            const weight = document.getElementById('weight').value;
            console.log(`Report Number: ${reportNumber}`);
            console.log(`Weight: ${weight}`);
            // Check if values are not empty
            if (reportNo && weight) {
                console.log("Report No: " + reportNo); // Log the Report No
                console.log("Weight: " + weight); // Log the Weight

                // You can now use these values as needed in your script, for example, fetching data or displaying results
                // If you want to send the data to a server or process it, you can proceed here
            } else {
                // Display an alert if any of the fields are empty
                alert("Please enter both Report No and Weight.");
            }
            // Fetch all data from the Apps Script
            $.getJSON("https://script.google.com/macros/s/AKfycby0uS8neN8VpbxnmAIdpJbWF6KbsvvlwgbwrlZBc22FtZmtL12MKKs7JSxLPYEiONpd/exec", function (data) {

                var Table = "", Rows = "", Columns = "";
                var found = false; // Flag to check if matching data is found

                // Loop through the fetched data
                $.each(data, function (key, value) {
                    // Log the value to see the exact comparison
                    console.log("Comparing Report No: " + value[1] + " with " + reportNo);
                    console.log("Comparing Weight: " + value[3] + " with " + weight);

                    // Convert value[3] to string and trim it, then compare
                    if (value[1].trim() === reportNo && String(value[3]).trim() === weight) {
                        found = true; // Set the flag to true when data is found
                        Columns = "";
                        document.getElementById("identifyAs2").innerHTML = "   IDENTIFIED AS :- NATURAL:-" + value[4] + ":-(" + value[0] + ")";
                        document.getElementById("refNo2").innerHTML = "<strong>RefNo: </strong>" + value[1];
                        document.getElementById("colour2").innerHTML = " : "+value[2];
                        document.getElementById("weight2").innerHTML = " : "+ value[3] + " Rt";
                        document.getElementById("species2").innerHTML = " : "+ value[4];
                        document.getElementById("shapeCut2").innerHTML = " : "+ value[5];
                        document.getElementById("transparency2").innerHTML = " : "+ value[6];
                        document.getElementById("opticCharacter2").innerHTML = " : "+ value[7];
                        document.getElementById("ri2").innerHTML = " : "+ value[8];
                        document.getElementById("sg2").innerHTML = " : "+ value[9];
                        document.getElementById("mm2").innerHTML = "<strong>MM:</strong> " + value[10];
                        document.getElementById("hardness2").innerHTML = " : "+ value[11];
                        document.getElementById("inclusions2").innerHTML = " : "+ value[12];
                        document.getElementById("remark2").innerHTML = " : "+ value[13];
                        console.log(value[14].replace("/view", "/preview").split('?')[0]);
                        // document.getElementById("imgGem").src = value[14].replace("/view", "/preview").split('?')[0];
                        fetchAndSetImage(value[14], "imgGem2")
                        // Create a table row for each matching entry
                        $.each(value, function (key1, value1) {
                            Columns = Columns + '<td>' + value1 + '</td>';
                        });

                        Rows = Rows + '<tr>' + Columns + '</tr>';
                    }
                });

                // If matching rows are found, append them to the table body
                // if (Rows) {
                //     $("#TableBody").html(Rows); // Update the table body with matching rows
                // } else {
                //     $("#TableBody").html('<tr><td colspan="15">No matching data found.</td></tr>'); // Display a message if no data is found
                // }

                // Show/hide the divs based on the result
                // if (found) {
                //     // Show the report card and hide not found and form for search
                //     $("#notFound").hide();
                //     document.getElementById("loadingSpinner").style.display = "none";
                //     $("#formForSearch").hide();
                //     $("#download").show();
                //     $("#reportCard").show();
                // } else {
                //     // Hide the report card and show not found and form for search
                //     document.getElementById("loadingSpinner").style.display = "none";
                //     $("#reportCard").hide();
                //     $("#notFound").show();
                //     $("#formForSearch").hide();
                //     $("#downloadBtn").hide();
                // }
            });

        });
    </script>

    <div id="printableCard" class=overflow-div style="padding-right: 5px; margin-bottom: 30px;">
        <div class=card-front>
            <div class=container-inner>
                <table class=table-header>
                    <tbody>
                        <tr>
                            <th rowspan=3><img class=logo-r src="images/logo.png" style="max-width: 45px;">
                            </th>
                            <th colspan=3 class=c-name>Sri Lab Report</th>
                            <th rowspan=3><img src="images/diamond.png"
                                    style="max-width: 45px;">
                            </th>
                        </tr>
                        <tr>
                            <td colspan=3 class=c-add>Gopal GK Road, Jaipur (Rajasthan)</td>
                        </tr>
                </table>
            </div>
            <div class=container-inner>
                <table class=g-table>
                    <tbody>
                        <tr>
                            <th colspan=4 class=report-type style="border-radius: 20px; margin-left: 20px;">Gems Testing
                                Report</th>
                        </tr>
                        <tr>
                            <th>Submitted By</th>
                            <td colspan=2>: </td>
                            <td colspan=2 style=text-align:center class=r-no id="refNo2">RefNo: KGTL/AA/6154</td>
                        </tr>
                        <tr>
                            <th>Colour</th>
                            <td id="colour2">: Red</td>
                            <td rowspan=8 style="text-align:center;padding-left: 30px; width: 200px;">
                                <img id="imgGem2" src="images/loading.gif" alt=""
                                    style="max-width: 200px; max-height: 100px; ">
                            </td>
                            <td rowspan=7 style="text-align:right">
                                <img src="images/qr.png" alt=""
                                    style="max-width: 100px; margin-right: 20px; margin-top: 20px;">
                            </td>
                        </tr>
                        <tr>
                            <th>Weight</th>
                            <th class=imp id="weight2">: 5.50 Rt</th>
                        </tr>
                        <tr>
                            <th>Spacies/Group</th>
                            <td id="species2">: coral</td>
                        </tr>
                        <tr>
                            <th>Shape &amp; Cut</th>
                            <td id="shapeCut2">: capsul</td>
                        </tr>
                        <tr>
                            <th>Transparency</th>
                            <td id="transparency2">: opaque</td>
                        </tr>
                        <tr>
                            <th>Optic Character</th>
                            <td id="opticCharacter2">: none</td>
                        </tr>
                        <tr>
                            <th>R.I</th>
                            <td id="ri2">: 1.486-1.658</td>
                        </tr>
                        <tr>
                            <th>S.G</th>
                            <td id="sg2">: 2.6-2.7</td>
                        </tr>
                        <tr>
                            <th>Hardness</th>
                            <td id="hardness2">: 3.5 </td>
                            <td style=text-align:center>
                                <span class=mm id="mm2">MM:</span>
                                N/A

                            </td>
                            <td rowspan="1" style="text-align: right; padding-right: 40px;">
                                <img src="images/sign.png" alt="" style="max-height: 30px;">
                            </td>
                        </tr>
                        <tr>
                            <th>Inclusions</th>
                            <td colspan=2 id="inclusions2">: Wood Grain Effect</td>
                            <td><span class=sign-text> V.K. JAIN, GEMOLOGIST</span></td>
                        </tr>
                        <tr>
                            <th>Remark</th>
                            <td colspan=2 id="remark2">: N-E-H</td>
                            <td><span class=sign-text2 style="margin-left: 3px;"><strong>For , SRI LABS JAIPURWWW
                                    </strong></span></td>
                        </tr>
                </table>
                <div id="identifyAs2" class=fg-footer style="text-align:left; margin-top: 4px;">&nbsp;   IDENTIFIED AS :-
                    NATURAL:-CORAL(MUNGA)
                </div>
            </div>
        </div>
    </div>

    <label id="downloadButton" style="
    display: inline-block; 
    padding: 12px 20px; 
    background-color: #4A90E2; 
    color: #ffffff; 
    text-align: center; 
    font-size: 16px; 
    font-weight: bold; 
    border-radius: 5px; 
    cursor: pointer; 
    transition: background-color 0.3s;">
        Download Card
    </label>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#downloadButton").on("click", function (e) {
                e.preventDefault(); // Prevents the default anchor action

                var element = document.getElementById("printableCard");

                if (!element) {
                    $("#errorField").val("Error: #reportCard element not found.");
                    return;
                }

                // Temporarily show the report card
                element.style.display = "block";

                // Wait for the content to be fully rendered
                html2canvas(element, { useCORS: true, logging: true })
                    .then(function (canvas) {
                        var imageData = canvas.toDataURL("image/jpeg");

                        // Create an invisible temporary link to trigger download
                        var tempLink = document.createElement('a');
                        tempLink.href = imageData;
                        tempLink.download = "card.jpg";

                        // Append the link to the body to trigger the download
                        document.body.appendChild(tempLink);
                        tempLink.click();

                        // Remove the temporary link after triggering the download
                        document.body.removeChild(tempLink);

                        // Hide the report card again after download
                        // element.style.display = "none";

                        // Clear error field if any
                        // $("#errorField").val("");
                    })
                    .catch(function (error) {
                        // Handle errors if any
                        // $("#errorField").val("Error capturing screenshot: " + error.message);
                        console.error("Error:", error);
                    });
            });
        });
    </script>


    <script>
        $(document).ready(function () {
            // Handle form submission
            $("formForPrint").on("submit", function (event) {
                event.preventDefault(); // Prevent form from submitting and page reloading

                // Get the values from the form fields
                var reportNo = $("input[name='reportNo2']").val().trim(); // Get the Report No
                var weight = $("input[name='weight2']").val().trim(); // Get the Weight

                // Check if values are not empty
                if (reportNo && weight) {
                    console.log("Report No: " + reportNo); // Log the Report No
                    console.log("Weight: " + weight); // Log the Weight

                    // You can now use these values as needed in your script, for example, fetching data or displaying results
                    // If you want to send the data to a server or process it, you can proceed here
                } else {
                    // Display an alert if any of the fields are empty
                    alert("Please enter both Report No and Weight.");
                }
                // Fetch all data from the Apps Script
                $.getJSON("https://script.google.com/macros/s/AKfycby0uS8neN8VpbxnmAIdpJbWF6KbsvvlwgbwrlZBc22FtZmtL12MKKs7JSxLPYEiONpd/exec", function (data) {

                    var Table = "", Rows = "", Columns = "";
                    var found = false; // Flag to check if matching data is found

                    // Loop through the fetched data
                    $.each(data, function (key, value) {
                        // Log the value to see the exact comparison
                        console.log("Comparing Report No: " + value[1] + " with " + reportNo);
                        console.log("Comparing Weight: " + value[3] + " with " + weight);

                        // Convert value[3] to string and trim it, then compare
                        if (value[1].trim() === reportNo && String(value[3]).trim() === weight) {
                            found = true; // Set the flag to true when data is found
                            Columns = "";
                            const imgElement = document.getElementById('imgGem2');
                            imgElement.src = 'images/loading.gif';
                            document.getElementById("identifyAs2").innerHTML = "IDENTIFIED AS :- NATURAL:-" + value[4] + ":-(" + value[0] + ")";
                            document.getElementById("refNo2").innerHTML = "<strong>RefNo: </strong>" + value[1];
                            document.getElementById("colour2").innerHTML = value[2];
                            document.getElementById("weight2").innerHTML = value[3] + " Rt";
                            document.getElementById("species2").innerHTML = value[4];
                            document.getElementById("shapeCut2").innerHTML = value[5];
                            document.getElementById("transparency2").innerHTML = value[6];
                            document.getElementById("opticCharacter2").innerHTML = value[7];
                            document.getElementById("ri2").innerHTML = value[8];
                            document.getElementById("sg2").innerHTML = value[9];
                            document.getElementById("mm2").innerHTML = "<strong>MM:</strong> " + value[10];
                            document.getElementById("hardness2").innerHTML = value[11];
                            document.getElementById("inclusions2").innerHTML = value[12];
                            document.getElementById("remark2").innerHTML = value[13];
                            console.log(value[14].replace("/view", "/preview").split('?')[0]);
                            // document.getElementById("imgGem").src = value[14].replace("/view", "/preview").split('?')[0];
                            fetchAndSetImage(value[14], "imgGem2")
                            // Create a table row for each matching entry
                            $.each(value, function (key1, value1) {
                                Columns = Columns + '<td>' + value1 + '</td>';
                            });

                            Rows = Rows + '<tr>' + Columns + '</tr>';
                        }
                    });

                    // If matching rows are found, append them to the table body
                    // if (Rows) {
                    //     $("#TableBody").html(Rows); // Update the table body with matching rows
                    // } else {
                    //     $("#TableBody").html('<tr><td colspan="15">No matching data found.</td></tr>'); // Display a message if no data is found
                    // }

                    // Show/hide the divs based on the result
                    // if (found) {
                    //     // Show the report card and hide not found and form for search
                    //     $("#notFound").hide();
                    //     document.getElementById("loadingSpinner").style.display = "none";
                    //     $("#formForSearch").hide();
                    //     $("#download").show();
                    //     $("#reportCard").show();
                    // } else {
                    //     // Hide the report card and show not found and form for search
                    //     document.getElementById("loadingSpinner").style.display = "none";
                    //     $("#reportCard").hide();
                    //     $("#notFound").show();
                    //     $("#formForSearch").hide();
                    //     $("#downloadBtn").hide();
                    // }
                });
            });
        });
    </script>

    

</body>